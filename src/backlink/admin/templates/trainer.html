{% extends "layout.html" %}
{% block title %}Trainer Â· Backlink Creator Bot{% endblock %}
{% block header %}Trainer{% endblock %}

{% block content %}
<div class="card border-0 shadow-sm mb-4" hx-ext="json-enc">
  <div class="card-header bg-white">
    <h2 class="h6 mb-0">Start new recording</h2>
  </div>

  <div class="card-body">
    <form
      class="row g-3"
      hx-post="/api/trainer/start"
      hx-encoding="json"
      hx-swap="none"
      hx-headers='{"X-CSRF-Token":"{{ csrf_token }}"}'
      hx-on::afterRequest="if(event.detail.successful){BacklinkApp.refreshTrainerSessions();}"
    >
      {# CSRF is sent via header; no hidden input needed #}

      <div class="col-md-4">
        <label class="form-label" for="tname">Recipe name</label>
        <input class="form-control" type="text" id="tname" name="name" required>
      </div>

      <div class="col-md-4">
        <label class="form-label" for="tsite">Site</label>
        <input class="form-control" type="text" id="tsite" name="site" required>
      </div>

      <div class="col-md-3">
        <label class="form-label" for="tcategory">Category</label>
        <select class="form-select" id="tcategory" name="category_id" required>
          {% for category in categories %}
          <option value="{{ category.id }}">{{ category.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-1 d-flex align-items-end">
        <button class="btn btn-primary w-100" type="submit">Start</button>
      </div>

      <div class="col-12">
        <label class="form-label" for="tdesc">Description</label>
        <textarea class="form-control" id="tdesc" name="description" rows="2"></textarea>
      </div>
    </form>
  </div>
</div>

{% include "partials/trainer_sessions.html" %}

<div class="card border-0 shadow-sm mt-4 d-none" data-trainer-feed-card>
  <div class="card-header bg-white d-flex justify-content-between align-items-center">
    <h2 class="h6 mb-0">Live trainer feed</h2>
    <span class="badge bg-secondary" data-trainer-label></span>
  </div>
  <div class="card-body" style="max-height: 320px; overflow-y: auto;">
    <ul class="list-group list-group-flush" data-trainer-feed></ul>
  </div>
</div>
{% endblock %}
