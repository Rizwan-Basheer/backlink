{% extends "layout.html" %}
{% block title %}Targets Â· Backlink Creator Bot{% endblock %}
{% block header %}Targets{% endblock %}

{% block content %}
<div class="card border-0 shadow-sm mb-4" hx-ext="json-enc">
  <div class="card-header bg-white">
    <h2 class="h6 mb-0">Add target URL</h2>
  </div>
  <div class="card-body">
    <form
      class="row g-3"
      hx-post="/api/targets"
      hx-encoding="json"
      hx-swap="none"
      hx-headers='{"X-CSRF-Token":"{{ csrf_token }}"}'
      hx-on::afterRequest="if(event.detail.successful){BacklinkApp.refreshTargets();}"
    >
      {# CSRF is sent in headers, no hidden input needed #}
      <div class="col-md-6">
        <label class="form-label" for="url">URL</label>
        <input class="form-control" type="url" id="url" name="url" placeholder="https://example.com" required>
      </div>

      <div class="col-md-3">
        <label class="form-label" for="title">Title (optional)</label>
        <input class="form-control" type="text" id="title" name="title">
      </div>

      <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary" type="submit">Save &amp; enrich</button>
      </div>
    </form>

    <p class="text-muted small mt-2">
      Enrichment runs in the background and populates title, summary, and keywords.
    </p>
  </div>
</div>

<div class="card border-0 shadow-sm" id="targets-card" hx-ext="json-enc">
  <div class="card-header bg-white d-flex justify-content-between align-items-center">
    <h2 class="h6 mb-0">Registered targets</h2>
  </div>
  {% include "partials/targets_table.html" %}
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  {# Ensure HTMX core + JSON encoder extension are available (omit if already loaded in layout.html) #}
  <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.12"></script>
  <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.12/dist/ext/json-enc.js"></script>
{% endblock %}
